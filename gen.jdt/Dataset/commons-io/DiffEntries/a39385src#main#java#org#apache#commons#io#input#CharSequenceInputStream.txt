Previous File: OUTPUT/commons-io/prevFiles/prev_a39385src#main#java#org#apache#commons#io#input#CharSequenceInputStream.java
Revised File: OUTPUT/commons-io/revFiles/a39385src#main#java#org#apache#commons#io#input#CharSequenceInputStream.java
DiffEntry: @@ -57,2 +57,3 @@
      * @param bufferSize the buffer size to use.
+     * @throws IllegalArgumentException if the buffer is not large enough to hold a complete character
      */

@@ -63,2 +64,7 @@
             .onUnmappableCharacter(CodingErrorAction.REPLACE);
+        // Ensure that buffer is long enough to hold a complete character
+        final float maxBytesPerChar = encoder.maxBytesPerChar();
+        if (bufferSize < maxBytesPerChar) {
+            throw new IllegalArgumentException("Buffer size " + bufferSize + " is less than maxBytesPerChar " + maxBytesPerChar);
+        }
         this.bbuf = ByteBuffer.allocate(bufferSize);

@@ -75,2 +81,3 @@
      * @param bufferSize the buffer size to use.
+     * @throws IllegalArgumentException if the buffer is not large enough to hold a complete character
      */

@@ -86,2 +93,3 @@
      * @param charset the character set name to use
+     * @throws IllegalArgumentException if the buffer is not large enough to hold a complete character
      */

@@ -97,2 +105,3 @@
      * @param charset the character set name to use
+     * @throws IllegalArgumentException if the buffer is not large enough to hold a complete character
      */

@@ -114,5 +123,2 @@
         }
-//        if (result.isUnderflow()) {
-//            result.throwException();
-//        }
         this.bbuf.flip();

